<sqls>
    <sql name="KTDOC_WORK_LOG">
        <![CDATA[
SELECT A.CLINIC_ID||'-'||A.EMP_ID AS AUTO_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID AS LP_CLI_SEE, --  主键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_SEE, --  关联键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_REG, --  关联键-门诊挂号业务
       B.BRBH AS LK_MPI_PATIENT, --  关联键-患者业务
       B.BRBH AS PATIENT_ID, --  患者标识
       A.CLINIC_ID AS OUTP_ID, --  门诊号
       A.REGISTER_ID AS OUTP_NO, --  门诊就诊流水号
       B.BRXM AS NAME, --  患者姓名
       A.DEPT_ID AS CLI_DEPT_CODE, --  就诊科室代码
      (SELECT MC FROM KSMC WHERE NO = A.DEPT_ID) AS CLI_DEPT_NAME, --  就诊科室名称
       A.START_TIME AS CLI_DTIME, --  就诊时间
       A.EMP_ID AS CLI_DOCT_CODE, --  医生代码
       (SELECT XM FROM ZGXX WHERE ID = A.EMP_ID)  AS CLI_DOCT_NAME, --  医生名称
       (SELECT C.ICD FROM KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_CODE, --  诊断编码
       (SELECT C.DISEASE_NAME FROM KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_NAME, --  诊断名称
       '' AS CHIEF_COMPLIANT, --  主诉
       A.SYSPTOM_CODE AS SYMPTOM_CODE, --  症状代码
       REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.SYSPTOM_CODE,'00','无下列症状'),'01','发热（低热）'),'02','发热（中热）'),'03','发热（高热）'),'04','发热（超高热）'),'05','腹泻'),'06','呕吐'),'07','皮疹'),'08','红眼'),'09','腮腺肿大'),'10','流感样症状'),'11','神经系统') AS SYMPTOM_NAME, --  症状名称
       '' AS MEDICAL_HISTORY, --  病史
       '' AS ALLERGIC_HISTORY, --  过敏史
       '' AS CHECK_UP, --  查体
       '' AS TREATMENT_PLAN, --  处置意见
       '' AS SBP, --  收缩压(MMHG)
       '' AS DBP, --  舒张压(MMHG)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'身高')+3,INSTR(REMARKS,'cm')-INSTR(REMARKS,'身高')-1) FROM KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS HEIGHT, --  身高(CM)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'体重')+3,INSTR(REMARKS,'kg')-INSTR(REMARKS,'体重')-1) FROM KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS WEIGHT, --  体重(KG)
       '' AS CONSULT_QUESTION, --  咨询问题
       '' AS HEALTH_REQUEST, --  卫生服务要求
       '' AS HEALTH_EVALUATION, --  健康问题评估
       '' AS OTHER_MEDICAL_TREATMENT, --  其他医学处置
       '' AS DIAG_CODING_TYPE, --  编码类型
       '' AS DIAG_NOTE, --  门诊诊断说明
       '' AS REFERRAL_FLAG, --  转诊标志
       '' AS REFERRAL_NOTE, --  转诊说明
       '' AS OTHER_DIAG_CODE, --   次诊断编码
       '' AS OTHER_DIAG_NAME, --  次诊断名称
       '' AS INFECTIOUS_FLAG, --  传染病标志
       DECODE(A.CHRONIC, 'N', '2', '1') AS CHRONIC_FLAG, --   慢病标志
 (SELECT max(SUBSTR(REMARKS,INSTR(REMARKS,'体温')+3,INSTR(REMARKS,'℃')-INSTR(REMARKS,'体温')-3)) FROM KTDOC_CASE_HISTORY WHERE CLINIC_ID = A.CLINIC_ID) AS TEMP, --   体温
       '' AS PULSE_CONDITION, --  脉象
       '' AS HEART_RATE, --   心率
       '' AS PAST_HISTORY, --   既往史
       A.SICKEN_TIME AS GETILL_DTIME, --   发病日期
       '' AS DIAG_DTIME, --   诊断日期
       A.RESULT AS PATIENT_GONE, --   病人去向
       '' AS PATIENT_GONE_OTHER, --   病人其他去向详述
A.END_TIME AS CLINIC_END_TIME,--诊毕时间
       '' AS OUTHOS_RESULT_CODE, --   治疗结果代码(转归)
       '' AS OUTHOS_RESULT_NAME, --   治疗结果名称(转归)
       A.START_TIME AS CREATE_DTIME, --  业务数据创建时间
       A.START_TIME AS UPDATE_DTIME, --  业务数据更新时间
       '' AS RECORD_DTIME,
       '' AS RECORD_UPDATE_DTIME
FROM KTDOC_WORK_LOG A, MZGHXX B
WHERE A.REGISTER_ID=B.MZH
    AND B.BRBH=A.SICK_ID
AND A.BRANCH_CODE='00'
        ]]>
    </sql>
</sqls>