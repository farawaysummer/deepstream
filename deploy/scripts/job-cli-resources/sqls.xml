<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql name="selectHIS">
        <![CDATA[
SELECT A.CLINIC_ID||'-'||A.EMP_ID AS AUTO_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID||'-'||'73427532' AS BASE_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID AS LP_CLI_SEE, --  主键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_SEE, --  关联键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_REG, --  关联键-门诊挂号业务
       B.BRBH AS LK_MPI_PATIENT, --  关联键-患者业务
       B.BRBH AS PATIENT_ID, --  患者标识
       A.CLINIC_ID AS OUTP_ID, --  门诊号
       A.REGISTER_ID AS OUTP_NO, --  门诊就诊流水号
       B.BRXM AS NAME, --  患者姓名
       A.DEPT_ID AS CLI_DEPT_CODE, --  就诊科室代码
      (SELECT MC FROM HMISW2003.KSMC WHERE NO = A.DEPT_ID  AND ROWNUM=1) AS CLI_DEPT_NAME, --  就诊科室名称
       A.START_TIME AS CLI_DTIME, --  就诊时间
       A.EMP_ID AS CLI_DOCT_CODE, --  医生代码
       (SELECT XM FROM HMISW2003.ZGXX WHERE ID = A.EMP_ID AND ROWNUM=1)  AS CLI_DOCT_NAME, --  医生名称
       (SELECT C.ICD FROM KTHIS.KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_CODE, --  诊断编码
       (SELECT C.DISEASE_NAME FROM KTHIS.KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_NAME, --  诊断名称
       '' AS CHIEF_COMPLIANT, --  主诉
       A.SYSPTOM_CODE AS SYMPTOM_CODE, --  症状代码
       REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.SYSPTOM_CODE,'00','无下列症状'),'01','发热（低热）'),'02','发热（中热）'),'03','发热（高热）'),'04','发热（超高热）'),'05','腹泻'),'06','呕吐'),'07','皮疹'),'08','红眼'),'09','腮腺肿大'),'10','流感样症状'),'11','神经系统') AS SYMPTOM_NAME, --  症状名称
       '' AS MEDICAL_HISTORY, --  病史
       '' AS ALLERGIC_HISTORY, --  过敏史
       '' AS CHECK_UP, --  查体
       '' AS TREATMENT_PLAN, --  处置意见
       '' AS SBP, --  收缩压(MMHG)
       '' AS DBP, --  舒张压(MMHG)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'身高')+3,INSTR(REMARKS,'cm')-INSTR(REMARKS,'身高')-1) FROM KTHIS.KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS HEIGHT, --  身高(CM)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'体重')+3,INSTR(REMARKS,'kg')-INSTR(REMARKS,'体重')-1) FROM KTHIS.KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS WEIGHT, --  体重(KG)
       '' AS CONSULT_QUESTION, --  咨询问题
       '' AS HEALTH_REQUEST, --  卫生服务要求
       '' AS HEALTH_EVALUATION, --  健康问题评估
       '' AS OTHER_MEDICAL_TREATMENT, --  其他医学处置
       '' AS DIAG_CODING_TYPE, --  编码类型
       '' AS DIAG_NOTE, --  门诊诊断说明
       '' AS REFERRAL_FLAG, --  转诊标志
       '' AS REFERRAL_NOTE, --  转诊说明
       '' AS OTHER_DIAG_CODE, --   次诊断编码
       '' AS OTHER_DIAG_NAME, --  次诊断名称
       '' AS INFECTIOUS_FLAG, --  传染病标志
       DECODE(A.CHRONIC, 'N', '2', '1') AS CHRONIC_FLAG, --   慢病标志
 (SELECT max(SUBSTR(REMARKS,INSTR(REMARKS,'体温')+3,INSTR(REMARKS,'℃')-INSTR(REMARKS,'体温')-3)) FROM KTHIS.KTDOC_CASE_HISTORY WHERE CLINIC_ID = A.CLINIC_ID) AS TEMP, --   体温
       '' AS PULSE_CONDITION, --  脉象
       '' AS HEART_RATE, --   心率
       '' AS PAST_HISTORY, --   既往史
       A.SICKEN_TIME AS GETILL_DTIME, --   发病日期
       '' AS DIAG_DTIME, --   诊断日期
       A.RESULT AS PATIENT_GONE, --   病人去向
       '' AS PATIENT_GONE_OTHER, --   病人其他去向详述
A.END_TIME AS CLINIC_END_TIME,--诊毕时间
       '' AS OUTHOS_RESULT_CODE, --   治疗结果代码(转归)
       '' AS OUTHOS_RESULT_NAME, --   治疗结果名称(转归)
       A.START_TIME AS CREATE_DTIME, --  业务数据创建时间
       A.START_TIME AS UPDATE_DTIME, --  业务数据更新时间
       '' AS RECORD_DTIME,
       '' AS RECORD_UPDATE_DTIME
FROM KTHIS.KTDOC_WORK_LOG A, HMISW2003.MZGHXX B
WHERE A.REGISTER_ID=B.MZH
    AND   B.BRBH=A.SICK_ID
AND A.BRANCH_CODE='00'
AND A.CLINIC_ID=?
        ]]>
    </sql>
    <sql name="insert">
        <![CDATA[
INSERT INTO S_CLI_SEERECORD (`BASE_ID`,`AUTO_ID`,`PATIENT_ID`,`OUTP_ID`,`OUTP_NO`,`NAME`,`CLI_DEPT_CODE`,`CLI_DEPT_NAME`,`CLI_DTIME`,`CLI_DOCT_CODE`,`CLI_DOCT_NAME`,`DIAG_CODE`,`DIAG_NAME`,`CHIEF_COMPLIANT`,`SYMPTOM_CODE`,`SYMPTOM_NAME`,`MEDICAL_HISTORY`,`ALLERGIC_HISTORY`,`CHECK_UP`,`TREATMENT_PLAN`,`SBP`,`DBP`,`HEIGHT`,`WEIGHT`,`CONSULT_QUESTION`,`HEALTH_REQUEST`,`HEALTH_EVALUATION`,`OTHER_MEDICAL_TREATMENT`,`DIAG_CODING_TYPE`,`DIAG_NOTE`,`REFERRAL_FLAG`,`REFERRAL_NOTE`,`CREATE_DTIME`,`UPDATE_DTIME`,`RECORD_DTIME`,`RECORD_UPDATE_DTIME`,`TEMP`,`CLINIC_END_TIME`)
 SELECT CAST(`BASE_ID` AS STRING),
CAST(`AUTO_ID` AS STRING),
CAST(`PATIENT_ID` AS STRING),
CAST(`OUTP_ID` AS STRING),
CAST(`OUTP_NO` AS STRING),
CAST(`NAME` AS STRING),
CAST(`CLI_DEPT_CODE` AS STRING),
CAST(`CLI_DEPT_NAME` AS STRING),
CAST(`CLI_DTIME` AS STRING),
CAST(`CLI_DOCT_CODE` AS STRING),
CAST(`CLI_DOCT_NAME` AS STRING),
CAST(`DIAG_CODE` AS STRING),
CAST(`DIAG_NAME` AS STRING),
CAST(`CHIEF_COMPLIANT` AS STRING),
CAST(`SYMPTOM_CODE` AS STRING),
CAST(`SYMPTOM_NAME` AS STRING),
CAST(`MEDICAL_HISTORY` AS STRING),
CAST(`ALLERGIC_HISTORY` AS STRING),
CAST(`CHECK_UP` AS STRING),
CAST(`TREATMENT_PLAN` AS STRING),
CAST(`SBP` AS STRING),
CAST(`DBP` AS STRING),
CAST(`HEIGHT` AS STRING),
CAST(`WEIGHT` AS STRING),
CAST(`CONSULT_QUESTION` AS STRING),
CAST(`HEALTH_REQUEST` AS STRING),
CAST(`HEALTH_EVALUATION` AS STRING),
CAST(`OTHER_MEDICAL_TREATMENT` AS STRING),
CAST(`DIAG_CODING_TYPE` AS STRING),
CAST(`DIAG_NOTE` AS STRING),
CAST(`REFERRAL_FLAG` AS STRING),
CAST(`REFERRAL_NOTE` AS STRING),
CAST(`CREATE_DTIME` AS STRING),
CAST(`UPDATE_DTIME` AS STRING),
CAST(`RECORD_DTIME` AS STRING),
CAST(`RECORD_UPDATE_DTIME` AS STRING),
CAST(`TEMP` AS STRING),
CAST(`CLINIC_END_TIME` AS STRING) FROM DTable
        ]]>
    </sql>
</sqls>
