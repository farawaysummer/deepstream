<?xml version="1.0" encoding="UTF-8" ?>
<job name="三院门诊处方业务作业">
    <!--捕获的变更事件相关配置-->
    <events>
        <event name="queryEvent">
            <!--数据变更事件的索引字段信息-->
            <eventKeys>
                <field name="KFDM" type="STRING" isKey="true"/>
                <field name="LX" type="STRING" isKey="true"/>
                <field name="NO" type="BIGINT" isKey="false"/>
                <field name="SFNO" type="BIGINT" isKey="false"/>
            </eventKeys>
            <!--读取的事件来源类型，一般为kafka或jdbc-cdc-->
            <eventType name="kafka">
                <!--读取的kafka主题名-->
                <config name="topic" value="9"/>
                <!--kafka的服务地址-->
                <config name="properties.bootstrap.servers" value="localhost:9092"/>
                <!--kafka的读取分组，默认即可-->
                <config name="properties.group.id" value="k_default"/>
                <!--kafka的读取偏移量设置，调试阶段可设置为earliest-offset , 正式运行时设置为group-offsets-->
                <config name="scan.startup.mode" value="latest-offset"/>
                <!--kafka的读取格式，从CDC的数据主题中读取格式为ruisoft-koalaspeed-->
                <config name="format" value="ruisoft-koalaspeed"/>
            </eventType>
        </event>
    </events>
    <!--处理过程中涉及到的表定义-->
    <relates>
        <!--表定义，包括表名和引用的字段定义，引用名与同目录下的table-*.xml文件相同-->
        <table name="S_CLI_RECIPE" ref="s_cli_recipe">
<!--            &lt;!&ndash;表与真实物理数据存储的映射，类型为jdbc意味着这张表与真实数据库中的某张表形成了映射关系&ndash;&gt;-->
<!--            <tableType name="jdbc">-->
<!--                &lt;!&ndash;连接信息&ndash;&gt;-->
<!--                <config name="url" value="jdbc:mysql://10.48.251.50:3306/ods?useSSL=false&amp;autoReconnect=true"/>-->
<!--                &lt;!&ndash;用户名&ndash;&gt;-->
<!--                <config name="username" value="ruisoft"/>-->
<!--                &lt;!&ndash;密码&ndash;&gt;-->
<!--                <config name="password" value="Ruisoft@123"/>-->
<!--                &lt;!&ndash;驱动类名&ndash;&gt;-->
<!--                <config name="driver" value="com.mysql.cj.jdbc.Driver"/>-->
<!--                &lt;!&ndash;真实表名&ndash;&gt;-->
<!--                <config name="table-name" value="s_cli_recipe"/>-->
<!--            </tableType>-->
            <tableType name="upsert-kafka">
                <!--读取的kafka主题名-->
                <config name="topic" value="s_cli_recipe"/>
                <!--kafka的服务地址-->
                <config name="properties.bootstrap.servers" value="10.48.251.50:9092"/>
                <!--kafka的读取分组，默认即可-->
                <config name="properties.group.id" value="cli_group"/>
                <!--kafka的读取格式，从CDC的数据主题中读取格式为ruisoft-koalaspeed-->
                <config name="key.format" value="json"/>
                <config name="value.format" value="json"/>
            </tableType>
        </table>
    </relates>
    <process>
        <datasource name="HIS"/>
        <processSQL name="selectHIS"/>
        <sinkSQL name="insert"/>
        <transformJobs>
            <transform name="S_CLI_RECIPE-门诊处方"/>
            <transform name="NB_C01.04.00.00-门诊处方"/>
        </transformJobs>
        <delayQuerySecond>1</delayQuerySecond>
        <results>
            <field name="ORG_CODE" type="VARCHAR2"/>
            <field name="AUTO_ID" type="VARCHAR2"/>
            <field name="LP_CLI_RECIPE" type="VARCHAR2"/>
            <field name="LK_CLI_RECIPE" type="VARCHAR2"/>
            <field name="LK_CLI_SEE" type="VARCHAR2"/>
            <field name="LK_MPI_PATIENT" type="VARCHAR2"/>
            <field name="PATIENT_ID" type="VARCHAR2"/>
            <field name="OUTP_ID" type="VARCHAR2"/>
            <field name="OUTP_NO" type="VARCHAR2"/>
            <field name="RECIPE_NO" type="VARCHAR2"/>
            <field name="RECIPE_DTIME" type="TIMESTAMP"/>
            <field name="RECIPE_DEPT_CODE" type="VARCHAR2"/>
            <field name="RECIPE_DEPT_NAME" type="VARCHAR2"/>
            <field name="RECIPE_DOC_CODE" type="VARCHAR2"/>
            <field name="RECIPE_DOC_NAME" type="VARCHAR2"/>
            <field name="DRUG_FLAG" type="CHAR"/>
            <field name="ITEM_CODE" type="VARCHAR2"/>
            <field name="ITEM_NAME" type="VARCHAR2"/>
            <field name="ITEM_TYPE_CODE" type="VARCHAR2"/>
            <field name="ITEM_TYPE_NAME" type="VARCHAR2"/>
            <field name="UNIT_PRICE" type="VARCHAR2"/>
            <field name="QTY" type="VARCHAR2"/>
            <field name="UNIT" type="VARCHAR2"/>
            <field name="SPEC" type="VARCHAR2"/>
            <field name="DRUG_RECP_TYPECODE" type="VARCHAR2"/>
            <field name="DRUG_RECP_TYPENAME" type="VARCHAR2"/>
            <field name="DRUG_USE_FREQCODE" type="VARCHAR2"/>
            <field name="DRUG_USE_FREQNAME" type="VARCHAR2"/>
            <field name="DRUG_EACH_DOSE" type="VARCHAR2"/>
            <field name="DRUG_DOSE_UNIT" type="VARCHAR2"/>
            <field name="DRUG_USAGE_CODE" type="VARCHAR2"/>
            <field name="DRUG_USAGE_NAME" type="VARCHAR2"/>
            <field name="DOSAGE_FORM_CODE" type="VARCHAR2"/>
            <field name="DOSAGE_FORM_NAME" type="VARCHAR2"/>
            <field name="DRUG_TOTAL_DOSE" type="VARCHAR2"/>
            <field name="DRUG_TOTAL_UNIT" type="VARCHAR2"/>
            <field name="DRUG_START_DTIME" type="CHAR"/>
            <field name="DRUG_END_DTIME" type="CHAR"/>
            <field name="DURG_SEND_DTIME" type="TIMESTAMP"/>
            <field name="DRUG_USE_DAYS" type="VARCHAR2"/>
            <field name="DRUG_PACKAGE_QTY" type="VARCHAR2"/>
            <field name="DRUG_PACKAGE_UNIT" type="VARCHAR2"/>
            <field name="DRUG_MIN_UNIT" type="CHAR"/>
            <field name="DRUG_BASE_DOSE" type="CHAR"/>
            <field name="DRUG_MAIN_FLAG" type="VARCHAR2"/>
            <field name="GROUP_NO" type="VARCHAR2"/>
            <field name="DRUG_HERB_FOOTNOTES" type="CHAR"/>
            <field name="HERB_DOSE_QTY" type="VARCHAR2"/>
            <field name="CHARGE_FLAG" type="CHAR"/>
            <field name="CHARGE_DTIME" type="TIMESTAMP"/>
            <field name="DRUG_SKIN_FLAG" type="VARCHAR2"/>
            <field name="DRUG_SKIN_RESULT" type="VARCHAR2"/>
            <field name="INSPECTION_PART_CODE" type="CHAR"/>
            <field name="INSPECTION_PART_NAME" type="CHAR"/>
            <field name="EMER_FLAG" type="CHAR"/>
            <field name="APPLY_NO" type="CHAR"/>
            <field name="REPORT_NO" type="CHAR"/>
            <field name="NOTE" type="VARCHAR2"/>
            <field name="USE_TIMES" type="CHAR"/>
            <field name="PRODUCTION_PLACE" type="VARCHAR2"/>
            <field name="PRODUCTION_DTIME" type="CHAR"/>
            <field name="VALID_DTIME" type="CHAR"/>
            <field name="MEDIC_CODE" type="VARCHAR2"/>
            <field name="MEDIC_CODE_SAFETY" type="VARCHAR2"/>
            <field name="MEDIC_SELF" type="CHAR"/>
            <field name="MEDIC_SAFETY" type="CHAR"/>
            <field name="CREATE_DTIME" type="TIMESTAMP"/>
            <field name="UPDATE_DTIME" type="TIMESTAMP"/>
            <field name="RECORD_DTIME" type="CHAR"/>
            <field name="RECORD_UPDATE_DTIME" type="CHAR"/>
            <field name="INFOR_SOURCE" type="CHAR"/>
            <field name="INFOR_IDENTIFICATION_CODE" type="VARCHAR2"/>
            <field name="INFOR_VALID_DATE" type="VARCHAR2"/>
            <field name="INFOR_REVIEWER_NAME" type="VARCHAR2"/>
            <field name="INFOR_REVIEWER_ID" type="VARCHAR2"/>
            <field name="INFOR_REVIEW_TIME" type="TIMESTAMP"/>
            <field name="INFOR_PRESCRIBE_TIME" type="TIMESTAMP"/>
            <field name="INFOR_DISPENSE_TIME" type="TIMESTAMP"/>
            <field name="INFOR_STATUS" type="CHAR"/>
            <field name="INFOR_CANCEL_TIME" type="VARCHAR2"/>
            <field name="INFOR_PRES_FEE" type="VARCHAR2"/>
            <field name="INFOR_PRESCRIBE_EMP_NAME" type="VARCHAR2"/>
            <field name="INFOR_PRESCRIBE_EMP_ID" type="VARCHAR2"/>
            <field name="INFOR_DISPENSE_EMP_NAME" type="VARCHAR2"/>
            <field name="INFOR_DISPENSE_EMP_ID" type="VARCHAR2"/>
            <field name="INFOR_REMARK" type="VARCHAR2"/>
            <field name="INFOR_CIRCULATE_FLAG" type="VARCHAR2"/>
            <field name="LIST_CHARGE_ID" type="VARCHAR2"/>
            <field name="LIST_IS_MEDI" type="CHAR"/>
            <field name="LIST_IS_MAIN" type="VARCHAR2"/>
            <field name="LIST_ANTIBIOS_FLAG" type="CHAR"/>
            <field name="LIST_SPIRIT_FLAG" type="CHAR"/>
            <field name="LIST_ANAESTHETIZTION" type="VARCHAR2"/>
            <field name="LIST_BASE_FLAG" type="VARCHAR2"/>
            <field name="LIST_VACCINE_FLAG" type="CHAR"/>
            <field name="LIST_INFUSION_FLAG" type="VARCHAR2"/>
            <field name="LIST_WITHDRAWAL_FLAG" type="CHAR"/>
            <field name="LIST_DOSAGE_FORM" type="VARCHAR2"/>
            <field name="LIST_SPECIFICATION_UNIT" type="VARCHAR2"/>
            <field name="LIST_SPECIFICATION_" type="VARCHAR2"/>
            <field name="LIST_DISPENSE_NUMBER" type="VARCHAR2"/>
            <field name="LIST_DISPENSE_UNIT" type="VARCHAR2"/>
            <field name="LIST_DOSE_UNITNAME" type="VARCHAR2"/>
            <field name="LIST_DOSE_UNITID" type="VARCHAR2"/>
            <field name="LIST_USEUNIT_ID" type="VARCHAR2"/>
            <field name="LIST_IS_SKINTESTDRUG" type="VARCHAR2"/>
            <field name="LIST_REVISE_FLAG" type="CHAR"/>
            <field name="LIST_POISON_FLAG" type="VARCHAR2"/>
            <field name="LIST_POISONMADE_FLAG" type="VARCHAR2"/>
            <field name="LIST_MEDI_TIMING" type="VARCHAR2"/>
            <field name="LIST_DRUGUSE_TOTAL" type="VARCHAR2"/>
            <field name="LIST_DRUG_SOURCE" type="VARCHAR2"/>
            <field name="LIST_MEDI_SPEED" type="VARCHAR2"/>
            <field name="LIST_LIMITED_TIME" type="VARCHAR2"/>
            <field name="LIST_MEDI_PURPOSE" type="VARCHAR2"/>
            <field name="LIST_PROJECT_AMOUNT" type="VARCHAR2"/>
            <field name="LIST_ANTI_TUMOR_DRUG" type="CHAR"/>
            <field name="INFOR_CHARGE_ID" type="VARCHAR2"/>
            <field name="INFOR_FEE_PRES_ID" type="VARCHAR2"/>
        </results>
    </process>
</job>