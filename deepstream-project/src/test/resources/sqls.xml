<sqls>
    <sql name="KTDOC_WORK_LOG">
        <![CDATA[
SELECT A.CLINIC_ID||'-'||A.EMP_ID AS AUTO_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID||'-'||'73427532' AS BASE_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID AS LP_CLI_SEE, --  主键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_SEE, --  关联键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_REG, --  关联键-门诊挂号业务
       B.BRBH AS LK_MPI_PATIENT, --  关联键-患者业务
       B.BRBH AS PATIENT_ID, --  患者标识
       A.CLINIC_ID AS OUTP_ID, --  门诊号
       A.REGISTER_ID AS OUTP_NO, --  门诊就诊流水号
       B.BRXM AS NAME, --  患者姓名
       A.DEPT_ID AS CLI_DEPT_CODE, --  就诊科室代码
      (SELECT MC FROM KSMC WHERE NO = A.DEPT_ID) AS CLI_DEPT_NAME, --  就诊科室名称
       A.START_TIME AS CLI_DTIME, --  就诊时间
       A.EMP_ID AS CLI_DOCT_CODE, --  医生代码
       (SELECT XM FROM ZGXX WHERE ID = A.EMP_ID)  AS CLI_DOCT_NAME, --  医生名称
       (SELECT C.ICD FROM KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_CODE, --  诊断编码
       (SELECT C.DISEASE_NAME FROM KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_NAME, --  诊断名称
       '' AS CHIEF_COMPLIANT, --  主诉
       A.SYSPTOM_CODE AS SYMPTOM_CODE, --  症状代码
       REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.SYSPTOM_CODE,'00','无下列症状'),'01','发热（低热）'),'02','发热（中热）'),'03','发热（高热）'),'04','发热（超高热）'),'05','腹泻'),'06','呕吐'),'07','皮疹'),'08','红眼'),'09','腮腺肿大'),'10','流感样症状'),'11','神经系统') AS SYMPTOM_NAME, --  症状名称
       '' AS MEDICAL_HISTORY, --  病史
       '' AS ALLERGIC_HISTORY, --  过敏史
       '' AS CHECK_UP, --  查体
       '' AS TREATMENT_PLAN, --  处置意见
       '' AS SBP, --  收缩压(MMHG)
       '' AS DBP, --  舒张压(MMHG)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'身高')+3,INSTR(REMARKS,'cm')-INSTR(REMARKS,'身高')-1) FROM KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS HEIGHT, --  身高(CM)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'体重')+3,INSTR(REMARKS,'kg')-INSTR(REMARKS,'体重')-1) FROM KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS WEIGHT, --  体重(KG)
       '' AS CONSULT_QUESTION, --  咨询问题
       '' AS HEALTH_REQUEST, --  卫生服务要求
       '' AS HEALTH_EVALUATION, --  健康问题评估
       '' AS OTHER_MEDICAL_TREATMENT, --  其他医学处置
       '' AS DIAG_CODING_TYPE, --  编码类型
       '' AS DIAG_NOTE, --  门诊诊断说明
       '' AS REFERRAL_FLAG, --  转诊标志
       '' AS REFERRAL_NOTE, --  转诊说明
       '' AS OTHER_DIAG_CODE, --   次诊断编码
       '' AS OTHER_DIAG_NAME, --  次诊断名称
       '' AS INFECTIOUS_FLAG, --  传染病标志
       DECODE(A.CHRONIC, 'N', '2', '1') AS CHRONIC_FLAG, --   慢病标志
 (SELECT max(SUBSTR(REMARKS,INSTR(REMARKS,'体温')+3,INSTR(REMARKS,'℃')-INSTR(REMARKS,'体温')-3)) FROM KTDOC_CASE_HISTORY WHERE CLINIC_ID = A.CLINIC_ID) AS TEMP, --   体温
       '' AS PULSE_CONDITION, --  脉象
       '' AS HEART_RATE, --   心率
       '' AS PAST_HISTORY, --   既往史
       A.SICKEN_TIME AS GETILL_DTIME, --   发病日期
       '' AS DIAG_DTIME, --   诊断日期
       A.RESULT AS PATIENT_GONE, --   病人去向
       '' AS PATIENT_GONE_OTHER, --   病人其他去向详述
A.END_TIME AS CLINIC_END_TIME,--诊毕时间
       '' AS OUTHOS_RESULT_CODE, --   治疗结果代码(转归)
       '' AS OUTHOS_RESULT_NAME, --   治疗结果名称(转归)
       A.START_TIME AS CREATE_DTIME, --  业务数据创建时间
       A.START_TIME AS UPDATE_DTIME, --  业务数据更新时间
       '' AS RECORD_DTIME,
       '' AS RECORD_UPDATE_DTIME
FROM KTDOC_WORK_LOG A, MZGHXX B
WHERE A.REGISTER_ID=B.MZH
    AND B.BRBH=A.SICK_ID
AND A.BRANCH_CODE='00'
        ]]>
    </sql>

    <sql name="selectDIP">
        <![CDATA[
SELECT (SELECT VVALUE FROM DIP.SYSVAR WHERE VNAME = 'ORG_CODE' AND LENGTH(VVALUE) = 8 AND ROWNUM = 1) AS ORG_CODE,   --2022年6月21日10:04:32
       E.PRES_ID || '-' || E.NO || '-' || E.GROUPNO||'-1' AS AUTO_ID, --序列号
       E.PRES_ID || '-' || E.NO || '-' || E.GROUPNO||'-1'  AS LP_CLI_RECIPE, --主键-门诊处方业务
       E.PRES_ID AS LK_CLI_RECIPE, --关联键-门诊处方业务
       F.REGISTER_ID AS LK_CLI_SEE, --关联键-门诊就诊业务
       F.SICK_ID AS LK_MPI_PATIENT, --关联键-患者业务
       F.SICK_ID AS PATIENT_ID, --患者号
       F.REGISTER_ID AS OUTP_ID, --门诊号
       F.REGISTER_ID AS OUTP_NO, --门诊就诊流水号
       E.PRES_ID||'-'||C.CATEGORY AS RECIPE_NO, --处方号
       C.RECORD_TIME AS RECIPE_DTIME, --处方时间
       F.DEPT_ID AS RECIPE_DEPT_CODE, --开立科室代码
       (SELECT MC FROM DIP.KSMC WHERE NO = F.DEPT_ID) AS RECIPE_DEPT_NAME, --开立科室名称
       F.EMP_ID AS RECIPE_DOC_CODE, --开立医生代码
       (SELECT XM FROM DIP.ZGXX WHERE ID = F.EMP_ID) AS RECIPE_DOC_NAME, --开立医生名称
       '1' AS DRUG_FLAG, --药品标识
       E.DRUG_ID AS ITEM_CODE, --项目代码
       D.HZMC AS ITEM_NAME, --项目名称
       NVL(C.TYPE,'Q') AS ITEM_TYPE_CODE, --项目类别代码
       DECODE(C.TYPE,'Y','西药','Z','成药','C','中药','M','免煎','G','膏方','其他') AS ITEM_TYPE_NAME, --项目类别名称
       D.LSJ AS UNIT_PRICE, --单价
       E.QUANTITY AS QTY, --数量
       D.DW2 AS UNIT, --计价单位
       D.GG AS SPEC, --规格
       C.CATEGORY AS DRUG_RECP_TYPECODE, --处方类型代码
       (SELECT TITLE FROM DIP.CFFL WHERE XH = C.CATEGORY) AS DRUG_RECP_TYPENAME, --处方类型名称
       E.USAGE AS DRUG_USE_FREQCODE, --使用频次代码
       (SELECT MC FROM DIP.YZYFB WHERE DM = B.YF) AS DRUG_USE_FREQNAME, --使用频次名称
       E.DOSE AS DRUG_EACH_DOSE, --药品每次使用剂量
       D.JLDW AS DRUG_DOSE_UNIT, --剂量单位
       E.DRUG_WAY AS DRUG_USAGE_CODE, --药品使用用法代码
       (SELECT MC FROM DIP.GYFSB WHERE DM = E.DRUG_WAY) AS DRUG_USAGE_NAME, --药品使用用法名称
       D.JX AS DOSAGE_FORM_CODE, --药品剂型代码
       (SELECT MC FROM DIP.YPJX WHERE NO = D.JX) AS DOSAGE_FORM_NAME, --药品剂型名称
       E.QUANTITY AS DRUG_TOTAL_DOSE, --药品使用总剂量
       D.DW2 AS DRUG_TOTAL_UNIT, --药品使用总剂量单位
       '' AS DRUG_START_DTIME, --用药开始时间
       '' AS DRUG_END_DTIME, --用药停止时间
       A.FYSJ AS DURG_SEND_DTIME, --发药时间
       ROUND((SELECT TS/NUM FROM DIP.YZYFB WHERE DM = B.YF)*E.TIMES,2) AS DRUG_USE_DAYS, --药品使用天数
       D.SL2 AS DRUG_PACKAGE_QTY, --药品包装数量
       D.DW AS DRUG_PACKAGE_UNIT, --药品包装单位
       ''  AS DRUG_MIN_UNIT, --最小单位
       '' AS DRUG_BASE_DOSE, --药品基本剂量
       DECODE(E.IS_MAIN,'Y','1','2') AS DRUG_MAIN_FLAG, --主药标志
       E.PRES_ID || '-' || E.NO || '-' || E.GROUPNO AS GROUP_NO, --组合号
       '' AS DRUG_HERB_FOOTNOTES, --草药脚注
       E.TIMES AS HERB_DOSE_QTY, --药品付数
       CASE WHEN C.CHARGE_ID IS NOT NULL THEN '1' ELSE '2' END AS CHARGE_FLAG, --是否收费
       G.FSSJ AS CHARGE_DTIME, --收费时间
       DECODE(D.PSBJ, 'Y', '1', 'N', '2', '2') AS DRUG_SKIN_FLAG, --皮试判别标识
       DECODE(E.SKIN_TEST,
              '+',
              '阳',
              '-',
              '阴',
              'W',
              '未',
              'M',
              '免',
              'T',
              '脱敏',
              '') AS DRUG_SKIN_RESULT, --皮试结果
       '' AS INSPECTION_PART_CODE, --检查部位代码
       '' AS INSPECTION_PART_NAME, --检查部位名称
       '' AS EMER_FLAG, --加急标志
       '' AS APPLY_NO, --申请单号
       '' AS REPORT_NO, --报告单号
       C.DEMAND AS NOTE, --备注
       '' AS USE_TIMES, -- 使用频率
       D.CDMC AS PRODUCTION_PLACE, --生产产地
       '' AS PRODUCTION_DTIME, --生产日期
       '' AS VALID_DTIME, --有效日期
	   	 B.DM AS MEDIC_CODE, --	中心药品代码--------------------------------------------------上报市平台处理
     NVL(D.YBYPBM,'999')	 AS MEDIC_CODE_SAFETY, --	医保代码
    E.SELF_MARK AS MEDIC_SELF, --	自备  默认N
    E.MED_INS_MARK AS MEDIC_SAFETY, --	医保自负  默认N
       C.RECORD_TIME AS CREATE_DTIME, --业务数据创建时间
       C.RECORD_TIME AS UPDATE_DTIME, --业务数据更新时间
       '' AS RECORD_DTIME, --记录时间
       '' AS RECORD_UPDATE_DTIME, --记录更新时间



/****以下为2022年6月21日处方HIS贯通增加****/

'3'		AS	INFOR_SOURCE	,--	处方来源	S3	AN..2	Y	处方来源代码 NBC01.01.027	20211210新增
DECODE(C.CATEGORY ,'2','1','3','2','7','3','8','3','9','5','10','5','9')	AS	INFOR_IDENTIFICATION_CODE	,--	处方辨识代码	S3	AN..50	Y	处方辨识代码 NBC01.01.026	20211210新增
NVL(ROUND((SELECT TS/NUM FROM DIP.YZYFB WHERE DM = B.YF)*E.TIMES,2),'1')	AS	INFOR_VALID_DATE	,--	处方有效天数	N	N..4	Y	指处方超过多少天就不能核销（用于院内审核发药，外配药店发药）。	20211210新增
(SELECT XM FROM DIP.ZGXX WHERE ID = A.FYRY)	AS	INFOR_REVIEWER_NAME	,--	处方审核药剂师姓名	S1	AN..50	Y		20211210新增
(SELECT XM FROM DIP.ZGXX WHERE ID = A.FYRY)	AS	INFOR_REVIEWER_ID	,--	处方审核药剂师id	S3	N..10		中心人员库 NBD03.00.001	20211210新增 --------------------------------------------------上报市平台处理
A.FYSJ	AS	INFOR_REVIEW_TIME	,--	处方审核时间	D	DT15			20211210新增
A.PYSJ	AS	INFOR_PRESCRIBE_TIME	,--	配药时间	D	DT15			20211210新增
A.FYSJ	AS	INFOR_DISPENSE_TIME	,--	发药时间	D	DT15	Y		20211210新增
'0' 	AS	INFOR_STATUS	,--	处方状态	S3	AN..2	Y	处方状态代码 NBC01.01.025	20211210新增，20220419字典扩增
NULL AS	INFOR_cancel_time	,--	作废时间	D	DT15			20211215新增
(SELECT SUM(JE) FROM DIP.MZCFMXXX WHERE NO = A.NO )	AS	INFOR_PRES_FEE	,--	处方金额	N	N..20	Y	处方计价金额，单位为分	20220419新增
(SELECT XM FROM DIP.ZGXX WHERE ID = A.PYRY)	AS	INFOR_PRESCRIBE_EMP_NAME	,--	处方调配药剂师姓名	S1	AN..50		对门急诊处方进行调配的药剂师签署的在公安户籍管理部门正式登记注册的姓氏和名称	20220419新增
(SELECT XM FROM DIP.ZGXX WHERE ID = A.PYRY)	AS	INFOR_PRESCRIBE_EMP_ID	,--	处方调配药剂师编号	S1	AN..50		中心人员库 NBD03.00.001	20220419新增--------------------------------------------------上报市平台处理
(SELECT XM FROM DIP.ZGXX WHERE ID = A.FYRY)	AS	INFOR_DISPENSE_EMP_NAME	,--	处方发药药剂师姓名	S1	AN..50		按照审核、调配后的门急诊处方，给患者发药的药剂师签署的在公安户籍管理部门正式登记注册的姓氏和名称	20220419新增
(SELECT XM FROM DIP.ZGXX WHERE ID = A.FYRY)	AS	INFOR_DISPENSE_EMP_ID	,--	处方发药药剂师编号	S1	AN..50		中心人员库 NBD03.00.001	20220419新增--------------------------------------------------上报市平台处理
C.DEMAND	AS	INFOR_REMARK	,--	处方备注信息	S1	AN..2000		对处方信息的重要提示和补充说明	20220419新增

NULL	AS	INFOR_CIRCULATE_FLAG	,--	允许流转标志	S2	N1		1. 允许流转 2.不允许流转	20220419新增
A.SFNO	AS	LIST_CHARGE_ID	,--	收费号	N	AN..20	Y	与门诊收费表ORG_CHARGE_ID保持一致
'1'	AS	LIST_IS_MEDI	,--	是否药品	S3	AN..2	Y	是否代码表 NBP00.00.006	20211210新增
DECODE(E.IS_MAIN,'Y','1','2')	AS	LIST_IS_MAIN	,--	是否主药	S3	AN..2	Y	是否代码表 NBP00.00.006，输液处方，溶药为主药	20211210新增
CASE WHEN D.KSSJB>0 THEN '1' ELSE '2' END	AS	LIST_ANTIBIOS_FLAG	,--	抗菌药物标志	S3	AN..2	Y	抗生素级别代码表 NBD06.00.011	20211210新增
CASE WHEN D.YPGLBZ = 'J' AND D.TSYPDJ = '1' THEN '1' WHEN D.YPGLBZ = 'J' AND D.TSYPDJ = '2' THEN '2' WHEN D.YPGLBZ = 'J' AND D.TSYPDJ NOT IN('1','2') THEN '9' ELSE '8' END	AS	LIST_SPIRIT_FLAG	,--	精神药物标志	S3	AN..2		精神药物代码表 NBC01.01.032	20211213新增
DECODE(D.YPGLBZ,'M','1','2')	AS	LIST_ANAESTHETIZTION	,--	麻醉药物标志	S3	AN..2	Y	是否代码表 NBP00.00.006	20211210新增
(SELECT DECODE(JBYW,'Y','1','2') FROM DIP.YPMCQT WHERE YPBH = B.DM) AS	LIST_BASE_FLAG	,--	基本药物标志	S3	AN..2	Y	基药标志代码 NBC01.01.033	20211210新增
CASE WHEN (SELECT YMZLDM FROM DIP.YPMCQT WHERE YPBH = B.DM ) IS NULL THEN '2' ELSE '1' END	AS	LIST_VACCINE_FLAG	,--	疫苗标志	S3	AN..2	Y	是否代码表 NBP00.00.006	20211210新增
DECODE(D.YPGLBZ,'S','1','2')	AS	LIST_INFUSION_FLAG	,--	输液用药标志	S3	AN..2	Y	是否代码表 NBP00.00.006	20211210新增
CASE WHEN B.SL<0 THEN '1' ELSE '2' END	AS	LIST_WITHDRAWAL_FLAG	,--	退药标志	S3	AN..2	Y	是否代码表 NBP00.00.006	20211210新增
(SELECT MC FROM DIP.YPJX WHERE NO = D.JX)	AS	LIST_DOSAGE_FORM	,--	药物剂型代码	S3	AN..3	Y	药物剂型代码 NBC01.01.028	20211210新增	--------------------------------------------------值域转换
D.DW	AS	LIST_SPECIFICATION_UNIT	,--	药品包装规格单位	S1	AN..30	Y	药品包装规格单位，若是药品，必填。发药包装单位，例如：瓶、盒。对于医院自定义的包装，可以提供自定义的包装单位。	20211210新增
D.SL2	AS	LIST_SPECIFICATION_	,--	药品包装规格系数	S1	AN..30	Y	若是药品，必填。例如：12支/每盒中的12 ，是指每盒中有12支。这里的12是指当前包装中有12个药品规格字段中的装量单位“支”的数量。对于医院自定义的包装，请提供自定义的包装中包含的最小装量单位的数量，比如包装中包含有6支，其值就为6。	20211210新增
B.SL	AS	LIST_DISPENSE_NUMBER	,--	发药数量	N	N..8,2	Y		20211210新增
D.DW2	AS	LIST_DISPENSE_UNIT	,--	发药单位	S1	AN..6	Y		20211210新增
D.JLDW	AS	LIST_DOSE_UNITNAME	,--	剂量单位名称	S1	AN..16	Y		20211210新增
D.JLDW	AS	LIST_DOSE_UNITID	,--	剂量单位代码	S3	AN..16	Y	药物剂量单位代码 NBC01.01.029	20211210新增	--------------------------------------------------值域转换
D.DW1	AS	LIST_USEUNIT_ID	,--	用量单位代码	S3	AN..6	Y	药物用量单位代码 NBC01.01.030	20211210新增--------------------------------------------------值域转换
DECODE(D.PSBJ,'Y','1','2')	AS	LIST_IS_SKINTESTDRUG	,--	是否皮试药品	S3	AN..2	Y	是否代码表 NBP00.00.006	20211210新增
'0'	AS	LIST_REVISE_FLAG	,--	修改标志	S3	AN..2	Y	正常作废代码 NBC01.01.031	20211210新增
DECODE(D.YPGLBZ,'D','1','2')	AS	LIST_POISON_FLAG	,--	毒性药物标志	S2	N1		是否代码表 NBP00.00.006	20220419新增
DECODE(D.YPGLBZ,'D','1','2') AS	LIST_POISONMADE_FLAG	,--	易制毒药物标志	S2	N1		是否代码表 NBP00.00.006	20220419新增
NULL	AS	LIST_MEDI_TIMING	,--	给药时机	S1	AN..50		给药时机，如：饭前、饭后、空腹等	20220419新增
B.SL*D.SL1	AS	LIST_DRUGUSE_TOTAL	,--	药物使用总剂量	N	N..10,4		药物使用总剂量	20220419新增
DECODE(B.ZBBZ,'Y','2','1')	AS	LIST_DRUG_SOURCE	,--	药品来源代码	S2	N1		1.医院药品 2.自备药品	20220419新增
NULL	AS	LIST_MEDI_SPEED	,--	给药速度	S1	AN..20		给药速度，静脉输液药品滴注时间和速度的描述，如：1小时、20滴/分钟，需同时传入数字和单位，单位为小时或滴/分钟	20220419新增
NULL	AS	LIST_LIMITED_TIME	,--	限用时间	S1	AN..20		限用时间，静脉输液药品配制后使用时间的描述，如：现配现用、立即使用、2h内使用等	20220419新增
NULL	AS	LIST_MEDI_PURPOSE	,--	药嘱目的	S1	AN..50		药嘱目的，（药嘱开具的目的，科室领药、带手术室等）	20220419新增
B.JE	AS	LIST_PROJECT_AMOUNT	,--	项目金额	N	N..10		项目金额，单位：分	20220419新增
CASE WHEN (SELECT KZLYP FROM DIP.YPMCQT WHERE YPBH = B.DM )>0 THEN '1' ELSE '2' END		AS	LIST_ANTI_TUMOR_DRUG	--	抗肿瘤药物标志	S2	N1	Y	是否代码表 NBP00.00.006	20220516新增



FROM DIP.MZCFXX A ,DIP.MZCFMXXX B LEFT JOIN DIP.YPMC D ON B.DM = D.YPBH
,DIP.KTDOC_PRESCRIPTION C,DIP.KTDOC_PRESCRIPTION_LIST E,DIP.KTDOC_WORK_LOG F, DIP.MZSFXX G
WHERE A.NO = B.NO AND A.KFDM = B.KFDM AND A.LX = B.LX AND A.NO = C.FEE_PRES_ID AND A.SFNO = G.NO AND  G.MZH = F.REGISTER_ID AND F.CLINIC_ID = C.CLINIC_ID AND C.PRES_ID = E.PRES_ID AND B.DM= E.DRUG_ID AND B.ZH =E.GROUPNO
        ]]>
    </sql>

    <sql name="selectWorkLog">
        <![CDATA[
SELECT A.CLINIC_ID||'-'||A.EMP_ID AS AUTO_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID||'-'||'73427532' AS BASE_ID, --  源表物理主键
       A.CLINIC_ID||'-'||A.EMP_ID AS LP_CLI_SEE, --  主键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_SEE, --  关联键-门诊就诊业务
       A.REGISTER_ID AS LK_CLI_REG, --  关联键-门诊挂号业务
       B.BRBH AS LK_MPI_PATIENT, --  关联键-患者业务
       B.BRBH AS PATIENT_ID, --  患者标识
       A.CLINIC_ID AS OUTP_ID, --  门诊号
       A.REGISTER_ID AS OUTP_NO, --  门诊就诊流水号
       B.BRXM AS NAME, --  患者姓名
       A.DEPT_ID AS CLI_DEPT_CODE, --  就诊科室代码
      (SELECT MC FROM KSMC WHERE NO = A.DEPT_ID) AS CLI_DEPT_NAME, --  就诊科室名称
       A.START_TIME AS CLI_DTIME, --  就诊时间
       A.EMP_ID AS CLI_DOCT_CODE, --  医生代码
       (SELECT XM FROM ZGXX WHERE ID = A.EMP_ID)  AS CLI_DOCT_NAME, --  医生名称
       (SELECT C.ICD FROM KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_CODE, --  诊断编码
       (SELECT C.DISEASE_NAME FROM KTDOC_DIAGNOSE C WHERE C.CLINIC_ID=A.CLINIC_ID AND C.NO = 1) AS DIAG_NAME, --  诊断名称
       '' AS CHIEF_COMPLIANT, --  主诉
       A.SYSPTOM_CODE AS SYMPTOM_CODE, --  症状代码
       REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.SYSPTOM_CODE,'00','无下列症状'),'01','发热（低热）'),'02','发热（中热）'),'03','发热（高热）'),'04','发热（超高热）'),'05','腹泻'),'06','呕吐'),'07','皮疹'),'08','红眼'),'09','腮腺肿大'),'10','流感样症状'),'11','神经系统') AS SYMPTOM_NAME, --  症状名称
       '' AS MEDICAL_HISTORY, --  病史
       '' AS ALLERGIC_HISTORY, --  过敏史
       '' AS CHECK_UP, --  查体
       '' AS TREATMENT_PLAN, --  处置意见
       '' AS SBP, --  收缩压(MMHG)
       '' AS DBP, --  舒张压(MMHG)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'身高')+3,INSTR(REMARKS,'cm')-INSTR(REMARKS,'身高')-1) FROM KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS HEIGHT, --  身高(CM)
(SELECT SUBSTR(REMARKS,INSTR(REMARKS,'体重')+3,INSTR(REMARKS,'kg')-INSTR(REMARKS,'体重')-1) FROM KTDOC_CASE_HISTORY WHERE field = 'JCSJ' AND CLINIC_ID = A.CLINIC_ID) AS WEIGHT, --  体重(KG)
       '' AS CONSULT_QUESTION, --  咨询问题
       '' AS HEALTH_REQUEST, --  卫生服务要求
       '' AS HEALTH_EVALUATION, --  健康问题评估
       '' AS OTHER_MEDICAL_TREATMENT, --  其他医学处置
       '' AS DIAG_CODING_TYPE, --  编码类型
       '' AS DIAG_NOTE, --  门诊诊断说明
       '' AS REFERRAL_FLAG, --  转诊标志
       '' AS REFERRAL_NOTE, --  转诊说明
       '' AS OTHER_DIAG_CODE, --   次诊断编码
       '' AS OTHER_DIAG_NAME, --  次诊断名称
       '' AS INFECTIOUS_FLAG, --  传染病标志
       DECODE(A.CHRONIC, 'N', '2', '1') AS CHRONIC_FLAG, --   慢病标志
 (SELECT max(SUBSTR(REMARKS,INSTR(REMARKS,'体温')+3,INSTR(REMARKS,'℃')-INSTR(REMARKS,'体温')-3)) FROM KTDOC_CASE_HISTORY WHERE CLINIC_ID = A.CLINIC_ID) AS TEMP, --   体温
       '' AS PULSE_CONDITION, --  脉象
       '' AS HEART_RATE, --   心率
       '' AS PAST_HISTORY, --   既往史
       A.SICKEN_TIME AS GETILL_DTIME, --   发病日期
       '' AS DIAG_DTIME, --   诊断日期
       A.RESULT AS PATIENT_GONE, --   病人去向
       '' AS PATIENT_GONE_OTHER, --   病人其他去向详述
A.END_TIME AS CLINIC_END_TIME,--诊毕时间
       '' AS OUTHOS_RESULT_CODE, --   治疗结果代码(转归)
       '' AS OUTHOS_RESULT_NAME, --   治疗结果名称(转归)
       A.START_TIME AS CREATE_DTIME, --  业务数据创建时间
       A.START_TIME AS UPDATE_DTIME, --  业务数据更新时间
       '' AS RECORD_DTIME,
       '' AS RECORD_UPDATE_DTIME
FROM KTDOC_WORK_LOG A, MZGHXX B
WHERE A.REGISTER_ID=B.MZH
    AND B.BRBH=A.SICK_ID
AND A.BRANCH_CODE='00'
        ]]>
    </sql>
    <sql name="selectCDR">
        <![CDATA[
SELECT

(SELECT VVALUE FROM DIP.SYSVAR WHERE VNAME = 'ORG_CODE' AND LENGTH(VVALUE) = 8 AND ROWNUM = 1)		AS	ORG_CODE	,--	医疗机构代码	S3	AN..10	P	医疗机构代码基础字典库 NBD02.00.002 与就诊信息中clinic_id一致参考格式clinic_id=门诊号+接诊医生编号（不是五位的话在左边用0补足五位）+分院号（总院为00）
b.REGISTER_ID	AS	CLINIC_ID	,--	接诊编号	N	N..25	P
D.CH_ID	AS	NO	,--	文书序号	S1	AN..8	P	病历的文书序号
(SELECT ID FROM DIP.PUB_DEPT PD,DIP.KTDIC_DEPT KD WHERE KD.DEPT_CODE=PD.CODE AND KD.DEPT_ID=b.DEPT_ID)	AS	DEPT_CODE	,--	科室编号	S3	AN..8		中心科室库 NBD02.00.001
b.REGISTER_ID	AS	REGISTER_ID	,--	门诊号	S1	AN..30		与就诊信息中REGISTER_ID一致 参考格式REGISTER_ID =G是固定开头+分院号+门诊号
A.CARD_DATA	AS	CARDID	,--	就诊卡号	S1	AN..128	Y
B.EMP_ID	AS	EMP_ID	,--	医生编号	S3	N..10	Y	中心人员库NBD03.00.001	20220419调整必填
B.SICK_ID	AS	PAT_NO	,--	病历号	S1	AN..30	Y	在医院内部的病人唯一识别号
B.SICK_ID	AS	PERSONID	,--	内部号	S1	AN..22	P
C.NAME	AS	NAME	,--	患者姓名	S1	AN..32	Y
decode(C.SEX,'1','1','2','2','9','9','0')	AS	SEX	,--	性别	S3	AN1	Y	人的性别代码 NBP00.00.003(GB/T 2261.1-2003)	 性别(1=男/2=女/3=不详/9=其它)
C.DATE_OF_BIRTH	AS	BIRTHDAY	,--	出生日期	D	D8
Trunc((MONTHS_BETWEEN(B.START_TIME,C.DATE_OF_BIRTH)) / 12)		AS	AGE	,--	年龄（岁）	S1	AN..16		年龄满1周岁的实足年龄
case when (Trunc((MONTHS_BETWEEN(B.START_TIME,C.DATE_OF_BIRTH)) / 12)	) >=1 then 0 else  (Trunc((MONTHS_BETWEEN(B.START_TIME,C.DATE_OF_BIRTH)) )	)  end  	AS	AGE2	,--	年龄（月）	S1	AN..16		年龄不足1周岁的实足年龄
'01'	AS	CF_TYPE	,--	证件类型	S3	AN2		个体标识号类别代码CV0100.02
C.ID_CARD AS	IDCARD	,--	证件号码	S1	AN..18
A.INSURANCE_NO	AS	CARDNUM	,--	保险号码	S1	AN..20
B.START_TIME	AS	CLINIC_TIME	,--	就诊日期	DT	DT15	Y
B.TYPE	AS	IF_FIRSTVISIT	,--	初诊标志	S2	N1	Y	1急诊，2初诊，3复诊,4会诊
  NVL ( (SELECT LISTAGG (name, ',')within group (order by name)
                FROM DIP.pub_allergen, DIP.pat_allergen
               WHERE pat_id = c.pat_id AND allergen_id = id),
            '未发现')	AS	ALLERGIC_HISTORY	,--	过敏史	S1	AN..1000
 nvl(nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ROWNUM = 1
               AND (ED_CODE IN ('DE04.01.119.00','EMR142') or ED_CODE like '%主诉%')),
               (SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND (ED_CODE IN ('DE02.10.071.00','EMR140') or ED_CODE like '%病%史%')
               AND ROWNUM = 1)),'无')	AS	CHIEF_COMPLAINT	,--	病人主诉	S1	AN..4000	Y
   nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND (ED_CODE IN ('DE02.10.071.00','EMR140') or ED_CODE like '%病%史%')
               AND ROWNUM = 1),'无')	AS	HPC	,--	现病史	S1	AN..4000	Y		20220419调整必填
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND (ED_CODE in ('DE02.10.099.00','DE02.10.103.00') or ED_CODE like '%既往史%') and rownum=1 ),'无')	AS	PMH	,--	既往史	S1	AN..4000	Y		20220419调整必填

 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ROWNUM = 1
               AND (ED_CODE IN ('DE04.10.258.00','EMR141') or ED_CODE like '%体格检查%')),'无殊')	AS	PHYSIQUE	,--	体格检查	S1	AN..4000	Y		20220419调整必填
B.OPERTATION	AS	CLINIC_DISPOSE	,--	处理	S1	AN..4000
B.DIAGNOSE	AS	DIAGNOSE_NAME	,--	诊断	S1	AN..1000
	''		as DIAGNOSE_MEASUR,
B.REMARKS	AS	KTDOC_REMARK	,--	备注	S1	AN..4000		除上述规范外的个性化字段，如流调史等，写在这里。要求自带标题，例：“流调史：患者无武汉旅行史”
D.CREATE_TIME	AS	CREATE_TIME	,--	书写时间	DT	DT15	Y
   nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.099.01'
               AND ROWNUM = 1),'无')	AS	HIS_EPIDEMIC	,--	流行病学史	S1	AN..2000		患者流行病学史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.026.00'
               AND ROWNUM = 1),'无')		AS	HIS_DISEASE_INC	,--	疾病史（含外伤）	S1	AN..2000		患者既往健康状况和疾病（含外伤）的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.101.00'
               AND ROWNUM = 1),'无')		AS	HIS_PRE_INOCULATION	,--	预防接种史	S1	AN..2000		患者预防接种情况的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.061.00'
               AND ROWNUM = 1),'无')		AS	HIS_OPERATION	,--	手术史	S1	AN..2000		患者既往接受手术/操作经历的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.099.02'
               AND ROWNUM = 1),'无')		AS	HIS_BIRTH	,--	出生史	S1	AN..2000		患者出生史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.099.03'
               AND ROWNUM = 1),'无')		AS	HIS_GROWN	,--	生长史	S1	AN..2000		患者生长史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.099.04'
               AND ROWNUM = 1),'无')		AS	HIS_FEED	,--	喂养史	S1	AN..2000		患者喂养史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.100.00'
               AND ROWNUM = 1),'无')		AS	HIS_METACHYSIS	,--	输血史	S1	AN..2000		患者既往输血史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.097.00'
               AND ROWNUM = 1),'无')		AS	HIS_PERSONAL	,--	个人史	S1	AN..2000		患者个人生活习惯及有无烟、酒、药物等嗜好，职业与工作条件及有无工业毒物、粉尘、放射性物质接触史，有无冶游史的描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.098.00'
               AND ROWNUM = 1),'无')		AS	HIS_MARRY_CHILD	,--	婚育史	S1	AN..2000		患者婚育史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.102.00'
               AND ROWNUM = 1),'无')		AS	HIS_MENSES	,--	月经史	S1	AN..2000		患者月经史的详细描述	20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE02.10.103.00'
               AND ROWNUM = 1),'无')		AS	HIS_FAMILY	,--	家族史	S1	AN..2000		患者3代以内有血缘关系的家族成员中所患遗传疾病史的描述	20220419新增字段
 ''	AS	PULSE_RATE	,--	脉率	N	N..3		单位时间内脉搏次数的测量值，计量单位为次/min	20220419新增字段
substr((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='02'
               AND ROWNUM = 1),1,instr((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='02'
               AND ROWNUM = 1),'/')-1)	AS	SPB	,--	收缩压	N	N..3		上臂收缩压的测量值，计量单位为mmHg	20220419新增字段
substr((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='02'
               AND ROWNUM = 1),-1,length((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='02'
               AND ROWNUM = 1))-instr((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='02'
               AND ROWNUM = 1),'/'))	AS	DPB	,--	舒张压	N	N..3		上臂舒张压的测量值，计量单位为mmHg	20220419新增字段
(SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='HEIGHT'
               AND ROWNUM = 1)	AS	HEIGHT	,--	身高	N	N..5,1		身高的测量值，计量单位为cm	20220419新增字段
(SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='WEIGHT'
               AND ROWNUM = 1)	AS	WEIGHT	,--	体重	N	N..5,1		体重的测量值，计量单位为kg	20220419新增字段
''	AS	GESTATIONAL_AGE	,--	孕周（天）	N	N..3		孕妇的妊娠时长，计量单位为天	20220419新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='DE04.30.010.00'
               AND ROWNUM = 1),'无')		AS	ASSISTANT_EXAMINATION	,--	辅助检查项目	S1	AN..200		患者辅助检查、检验项目的通用名称	20220419新增字段
''	AS	PAIN_GRADE	,--	疼痛评分	S1	AN..200		患者的疼痛评分	20220419新增字段
''AS	EVALUATION_ALL	,--	各项评估	S1	AN..200		患者的各项评估	20220419新增字段
''	AS	WEST_DIAG_INHOS_DES	,--	健康教育	S1	AN..2000			20220419新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.02'
               AND ROWNUM = 1),'无')		AS	WZWS	,--	望诊-望神	S1	AN..200		望诊-望神的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.03'
               AND ROWNUM = 1),'无')	AS	WZWMS	,--	望诊-望面色	S1	AN..200		望诊-望面色的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.04'
               AND ROWNUM = 1),'无')	AS	WZWXT	,--	望诊-望形态	S1	AN..200		望诊-望形态的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.05'
               AND ROWNUM = 1),'无')	AS	WZWTLWGJQ	,--	望诊-望头颅五官九窍	S1	AN..200		望诊-望头颅五官九窍的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.06'
               AND ROWNUM = 1),'无')	AS	WZWPF	,--	望诊-望皮肤	S1	AN..200		望诊-望皮肤的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.07'
               AND ROWNUM = 1),'无')	AS	WZWLM	,--	望诊-望络脉	S1	AN..200		望诊-望络脉的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.08'
               AND ROWNUM = 1),'无')	AS	WZWPXWYFMW	,--	望诊-望排泄物与分泌物	S1	AN..200		望诊-望排泄物与分泌物的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.09'
               AND ROWNUM = 1),'无')	AS	WZSDM	,--	望诊-舌代码	S3	N..2		初诊必填。中医望诊舌代码NBE01.00.012有多个时以“|”分隔	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.10'
               AND ROWNUM = 1),'无')	AS	WZS	,--	望诊-舌	S1	AN..200		望诊-舌的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.11'
               AND ROWNUM = 1),'无')	AS	WZTDM	,--	望诊-苔代码	S3	N..2		初诊必填。中医望诊苔代码NBE01.00.013有多个时以“|”分隔	20220522 新增字段

  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.12'
               AND ROWNUM = 1),'无')	AS	WZT	,--	望诊-苔	S1	AN..200		望诊-苔的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.13'
               AND ROWNUM = 1),'无')	AS	WZQT1	,--	望诊-其他	S1	AN..200		望诊-其他的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.22'
               AND ROWNUM = 1),'无')	AS	WZTSY	,--	闻诊-听声音	S1	AN..200		闻诊-听声音的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.23'
               AND ROWNUM = 1),'无')	AS	WZXQW	,--	闻诊-嗅气味	S1	AN..200		闻诊-嗅气味的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.24'
               AND ROWNUM = 1),'无')	AS	WZQT2	,--	闻诊-其他	S1	AN..200		闻诊-其他的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.42'
               AND ROWNUM = 1),'无')	AS	WZHR	,--	问诊-寒热	S1	AN..200		问诊-寒热的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.43'
               AND ROWNUM = 1),'无')	AS	WZCH	,--	问诊-出汗	S1	AN..200		问诊-出汗的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.44'
               AND ROWNUM = 1),'无')	AS	WZTS	,--	问诊-头身	S1	AN..200		问诊-头身的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.45'
               AND ROWNUM = 1),'无')	AS	WZXXWF	,--	问诊-胸胁脘腹	S1	AN..200		问诊-胸胁脘腹的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.46'
               AND ROWNUM = 1),'无')	AS	WZEM	,--	问诊-耳目	S1	AN..200		问诊-耳目的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.47'
               AND ROWNUM = 1),'无')	AS	WZYSYKWDM	,--	问诊-饮食与口味代码	S3	N..2		初诊必填。中医问诊饮食与口味代码NBE01.00.014有多个时以“|”分隔	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.48'
               AND ROWNUM = 1),'无')	AS	WZYSYKW	,--	问诊-饮食与口味	S1	AN..200		问诊-饮食与口味的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.49'
               AND ROWNUM = 1),'无')	AS	WZSMDM	,--	问诊-睡眠代码	S3	N..2		初诊必填。中医问诊睡眠代码NBE01.00.015有多个时以“|”分隔	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.50'
               AND ROWNUM = 1),'无')	AS	WZSM	,--	问诊-睡眠	S1	AN..200		问诊-睡眠的描述	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.51'
               AND ROWNUM = 1),'无')	AS	WZDBDM	,--	问诊-大便代码	S3	N..2		初诊必填。中医问诊大便代码NBE01.00.016有多个时以“|”分隔	20220522 新增字段
  nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.52'
               AND ROWNUM = 1),'无')	AS	WZDB	,--	问诊-大便	S1	AN..200		问诊-大便的描述	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.53'
               AND ROWNUM = 1),'无')		AS	WZXB	,--	问诊-小便	S1	AN..200		问诊-小便的描述	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.54'
               AND ROWNUM = 1),'无')		AS	WZFN	,--	问诊-妇女	S1	AN..200		患者为女性时必填	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.55'
               AND ROWNUM = 1),'无')		AS	WZXE	,--	问诊-小儿	S1	AN..200		问诊-小儿的描述	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.56'
               AND ROWNUM = 1),'无')		AS	WZQT3	,--	问诊-其他	S1	AN..200		问诊-其他的描述	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.57'
               AND ROWNUM = 1),'无')		AS	QZMZDM	,--	切诊-脉诊代码	S3	N..2		初诊必填。中医切诊脉诊代码NBE01.00.017有多个时以“|”分隔	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.58'
               AND ROWNUM = 1),'无')		AS	QZMZ	,--	切诊-脉诊	S1	AN..200		切诊-脉诊的描述	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.59'
               AND ROWNUM = 1),'无')		AS	QZAZ	,--	切诊-按诊	S1	AN..200		切诊-按诊的描述	20220522 新增字段
 nvl((SELECT VALUE
          FROM DIP.EMR_CASE_HISTORY_STRUCT_DATA
         WHERE     CHD_ID = D.CHD_ID
               AND ED_CODE ='KT02.10.028.60'
               AND ROWNUM = 1),'无')		AS	QZQT	,--	切诊-其他	S1	AN..200		切诊-其他的描述	20220522 新增字段

''	AS	TCM_DIEASE_CODE	,--	中医病名代码	S1	AN..200	Y	患者在门（急）诊就诊时初步作出的疾病诊断在中医病名特定分类体系中的代码GB/T 15657-2021有多个时以“|”分隔	20220522 新增字段
''	AS	TCM_DIEASE_NAME	,--	中医病名名称	S1	AN..2000	Y	由医师根据患者就诊时的情况，综合分析所作出的中医诊断病名	20220522 新增字段
''	AS	TCM_SYNDROME_CODE	,--	中医证候代码	S1	AN..200	Y	患者在门（急）诊就诊时初步作出的疾病诊断在中医证候特定分类体系中的代码GB/T 15657-2021有多个时以“|”分隔	20220522 新增字段
''	AS	TCM_SYNDROME_NAME	,--	中医证候名称	S1	AN..2000	Y	由医师根据患者就诊时的情况，综合分析所作出的中医证候名称	20220522 新增字段
''	AS	THERAPEUTIC_METHOD_CODE	,--	治则治法代码	S1	AN..200		根据辨证结果采用的治则治法名称术语GB/T 15657-2021有多个时以“|”分隔	20220522 新增字段
''	AS	THERAPEUTIC_METHOD	,--	治则治法名称	S1	AN..2000		根据辨证结果采用的治则治法名称术语	20220522 新增字段
'1' AS CASE_TYPE,--病历类型	S1	AN..1		1西医 2 中医
  D.CH_ID||(SELECT VVALUE FROM DIP.SYSVAR WHERE VNAME = 'ORG_CODE' AND LENGTH(VVALUE) = 8 AND ROWNUM = 1)	AS	 AUTO_ID ,-- varchar(64) COLLATE utf8_bin NOT NULL,

  D.CH_ID||(SELECT VVALUE FROM DIP.SYSVAR WHERE VNAME = 'ORG_CODE' AND LENGTH(VVALUE) = 8 AND ROWNUM = 1)	AS BASE_ID ,--varchar(64) COLLATE utf8_bin NOT NULL,
''	 AS  HOSP_NAME,-- varchar(255) COLLATE utf8_bin DEFAULT NULL,
'' AS  HOSP_ID,-- varchar(255) COLLATE utf8_bin DEFAULT NULL,
B.SICK_ID	 AS  PATIENT_ID,-- varchar(255) COLLATE utf8_bin DEFAULT NULL COMMENT '患者ID，关联MPI',
B.REGISTER_ID	AS  LK_CLI_REG,
D.CREATE_TIME	 AS CREATE_DTIME,-- datetime DEFAULT NULL,
D.CHANGE_TIME	 AS  UPDATE_DTIME,-- datetime DEFAULT NULL,
'' 	AS   RECORD_DTIME ,--datetime DEFAULT NULL,
'' 	AS   RECORD_UPDATE_DTIME ,--datetime DEFAULT NULL,

'aaa'  AS RBUSINESS_DATE -- datetime DEFAULT NULL,

      FROM DIP.OIS_REG_INFO A,
       DIP.KTDOC_WORK_LOG B,
       DIP.PAT_REGISTER C,
       DIP.EMR_CASE_HISTORY_DOCUMENT D,
       DIP.EMR_CASE_HISTORY_INFO E


 WHERE   B.register_id = a.opc_no
 AND b.branch_code =  SUBSTR (A.branch_code, -2, 2)
 and a.opc_id=c.REG_ID
       AND C.SOURCE_TYPE = 1
       AND E.SOURCE_TYPE=1
       AND D.CH_ID = E.CH_ID
       AND C.REG_ID = E.REG_ID


        ]]>
    </sql>
</sqls>